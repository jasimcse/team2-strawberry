<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core">

<ui:composition template="/common/template.xhtml">

	<ui:define name="pageContent">
	  
		<h:form>
			<h:panelGroup>
				<h:outputLabel value="Избери клиент" />
				<h:commandButton value="Избери" action="#{aktualiziraneNaKlientskaPoru4ka.chooseClient()}" /> 
				<h:panelGroup rendered="#{not empty aktualiziraneNaKlientskaPoru4ka.client.person}">
	    			<!-- ако клиентът е физическо лице се изчертава това -->
		    		<h:outputLabel value="Име на клиент">
		    			<h:inputText id="searchpersonname" value="#{aktualiziraneNaKlientskaPoru4ka.client.person.name}" maxlength="50" 
							readonly = "true" />
		    			<h:message for="searchpersonname" />
		   			</h:outputLabel>
		    		<h:outputLabel value="Фамилия на клиент">
		   	 			<h:inputText id="searchpersonfamily" value="#{aktualiziraneNaKlientskaPoru4ka.client.person.family}" maxlength="50" 
							readonly = "true" />
		    			<h:message for="searchpersonfamily" />
		    		</h:outputLabel>
				</h:panelGroup>
	         
	    		<h:panelGroup rendered="#{not empty aktualiziraneNaKlientskaPoru4ka.client.company}">
	    			<!-- ако клиентът е юридическо лице се изчертава това -->
					<h:outputLabel value="Наименование на фирма">
						<h:inputText id="searchcompanyname" value="#{aktualiziraneNaKlientskaPoru4ka.client.company.name}" maxlength="100" 
							readonly = "true" />
		   				<h:message for="searchcompanyname" />
					</h:outputLabel>
				</h:panelGroup>
				<br />
				
		
				<h:outputLabel value="Регистрационен номер на автомобила*">
	    			<h:inputText id="searchplatenum" value="#{dobavqneNaKlientskaPoru4ka.vehicle.plateNumber}" maxlength="8" 
	    				readonly="true"/>
	    			<h:message for="searchplatenum" />
	   		 	</h:outputLabel> 
	   			 <h:commandButton value="Избери" action="#{dobavqneNaKlientskaPoru4ka.chooseAvtomobil()}" /> 
	    		<br />
	    		
	    		<h:outputLabel value="Автосервиз">
	    			<h:selectOneMenu value="#{aktualiziraneNaKlientskaPoru4ka.searchAutoservice}">
						<f:selectItems value="#{aktualiziraneNaKlientskaPoru4ka.autoservice.name}" />
					</h:selectOneMenu>
	    		</h:outputLabel>
	    		<br />
	    		
	    		<h:outputLabel value="Име на служител">
		    		<h:inputText id="searchempname" value="#{aktualiziraneNaKlientskaPoru4ka.client.person.name}" maxlength="50" 
						readonly = "true" />
		    		<h:message for="searchempname" />
		   		</h:outputLabel>
		    	<h:outputLabel value="Фамилия на служител">
		   	 		<h:inputText id="searchempfamily" value="#{aktualiziraneNaKlientskaPoru4ka.client.person.family}" maxlength="50" 
						readonly = "true" />
		    		<h:message for="searchempfamily" />
		    	</h:outputLabel>
		    	<h:commandButton value="Избери" action="#{aktualiziraneNaKlientskaPoru4ka.chooseEmployee()}" /> 
		    	<br />
		    		
				<h:outputLabel value="Начална дата">
					<h:inputText value="" maxlength="50" />
					<!-- TODO - конвертор -->
				</h:outputLabel>
				<h:outputLabel value="Крайна дата">
					<h:inputText value="" maxlength="50" />
					<!-- TODO - конвертор -->
				</h:outputLabel>
				<br />
				
				<h:outputLabel value="Статус на поръчката">
	    			<h:selectOneMenu value="#{aktualiziraneNaKlientskaPoru4ka.searchStatus}">
						<f:selectItems value="#{aktualiziraneNaKlientskaPoru4ka.orderStatus}" />
					</h:selectOneMenu>
	    		</h:outputLabel>
	    		<br />
		
				<h:commandButton value="Търси" disabled="true" />
				<h:commandButton value="Изчисти" disabled="true" /> &lt;---- Да се направи
			</h:panelGroup>
		</h:form>
		
		<div style="overflow-x: auto;"> <!-- scroll bar -->
		<h:form>
			
			<!-- за Калин - избрания ред ще има клас = "selectedRow", неизбраните = "notSelectedRow" -->
			<h:dataTable
				rows="#{configurationProperties.getPageSize()}"
				value="#{aktualiziraneNaKlientskaPoru4ka.spisukPoru4ki}"
			    first="0"
			    var="curr"
			    rowClasses="#{aktualiziraneNaKlientskaPoru4ka.rowStyleClasses}">


				<h:column>
					<f:facet name="header">Име</f:facet>
					<h:outputText value="#{curr.client.person.name}" rendered="#{not empty curr.client.person.name}" />
				</h:column>
				
				<h:column>
					<f:facet name="header">Фамилия</f:facet>
					<h:outputText value="#{curr.client.person.family}" rendered="#{not empty curr.client.person.family}" />
				</h:column>
				
				<h:column>
					<f:facet name="header">Наименование на юридическо лице</f:facet>
					<h:outputText value="#{curr.client.company.name}" rendered="#{not empty curr.client.company.name}" />
				</h:column>
				
				<h:column>
					<f:facet name="header">Регистрационен номер</f:facet>
					<h:outputText value="#{curr.vehicle.plateNumber}"  />
				</h:column>
				
				<h:column>
					<f:facet name="header">Автосервиз</f:facet>
					<h:outputText value="#{curr.autoservice.name}"  />
				</h:column>
				
				<h:column>
					<f:facet name="header">Приемчик</f:facet>
					<h:outputText value="#{curr.employee.name}"  />
				</h:column>
				
				<h:column>
					<f:facet name="header">Приет автомобил</f:facet>
					<h:outputText value="#{curr.vehiclePresent}"  />
				</h:column>
				
				<h:column>
					<f:facet name="header">Дата</f:facet>
					<h:outputText value="#{curr.date}">
						<f:convertDateTime pattern="dd.MM.yyyy" />
					</h:outputText>
				</h:column>
				
				<h:column>
					<f:facet name="header">Статус</f:facet>
					<h:outputText value="#{curr.status}"  />
				</h:column>
				
				
				
				<h:column>
					<f:facet name="header">Промени</f:facet>
					<h:commandLink action="#{aktualiziraneNaKlientskaPoru4ka.selectRow(curr)}" value="Промени" />
				</h:column>
				
				<h:column rendered="#{aktualiziraneNaKlientskaPoru4ka.choosingAllowed}">
					<f:facet name="header">Избери</f:facet>
					<h:commandLink action="#{aktualiziraneNaKlientskaPoru4ka.choosePoru4ka(curr)}" value="Избери" />
				</h:column>
				
				<f:facet name="footer">
				
					<!-- предишна страница -->
					<h:commandLink disabled="#{aktualiziraneNaKlientskaPoru4ka.page - 1 lt 0}"
						action="#{aktualiziraneNaKlientskaPoru4ka.setPage(aktualiziraneNaKlientskaPoru4ka.page - 1)}"
						value="&lt;&lt;" />
						
					<h:outputText value=" " />
						
					<!-- други страници -->
					<ui:repeat value="#{aktualiziraneNaKlientskaPoru4ka.pagesList}" var="currPage">
						<h:commandLink
							disabled="#{aktualiziraneNaKlientskaPoru4ka.getPage() eq currPage.intValue() - 1}"
							action="#{aktualiziraneNaKlientskaPoru4ka.setPage(currPage.intValue() - 1)}"
							value="#{currPage}" />
							
						<h:outputText value=" " />
					</ui:repeat>
					
					<!-- следваща страница -->
					<h:commandLink disabled="#{aktualiziraneNaKlientskaPoru4ka.page + 1 ge aktualiziraneNaKlientskaPoru4ka.pagesCount}"
						action="#{aktualiziraneNaKlientskaPoru4ka.setPage(aktualiziraneNaKlientskaPoru4ka.page + 1)}"
						value="&gt;&gt;" />
							
				</f:facet>
				 
			</h:dataTable>
			
	   </h:form>
	   </div>
	   
	   
		<h:form>
	     
	     
	     	<h:panelGroup rendered="#{not empty aktualiziraneNaKlientskaPoru4ka.client.person}">
	    	<!-- ако клиентът е физическо лице се изчертава това -->
		    <h:outputLabel value="Име на клиент">
		    	<h:inputText id="personname" value="#{aktualiziraneNaKlientskaPoru4ka.client.person.name}" maxlength="50" 
		    		required="false" requiredMessage="задължително поле!" 
					readonly = "true" />
		    	<h:message for="personname" />
		    </h:outputLabel>
		    <h:outputLabel value="Фамилия на клиент">
		    	<h:inputText id="personfamily" value="#{aktualiziraneNaKlientskaPoru4ka.client.person.family}" maxlength="50" 
		    		required="false" requiredMessage="задължително поле!"
					readonly = "true" />
		    	<h:message for="personfamily" />
		    </h:outputLabel>
		</h:panelGroup>
	         
	    <h:panelGroup rendered="#{not empty aktualiziraneNaKlientskaPoru4ka.client.company}">
	    	<!-- ако клиентът е юридическо лице се изчертава това -->
			<h:outputLabel value="Наименование на фирма">
				<h:inputText id="companyname" value="#{aktualiziraneNaKlientskaPoru4ka.client.company.name}" maxlength="100" 
		   			required="false" requiredMessage="задължително поле!"
					readonly = "true" />
		   		<h:message for="companyname" />
			</h:outputLabel>
		</h:panelGroup>
		<br />
 		
 		<h:outputLabel value="Регистрационен номер на автомобила*">
	    	<h:inputText id="platenum" value="#{aktualiziraneNaKlientskaPoru4ka.vehicle.plateNumber}" maxlength="8" 
	    		readonly="true"/>
	    	<h:message for="platenum" />
	    </h:outputLabel>
	     <br />
	     
	     
	     <h:outputLabel value="Автосервиз, в който се изпълнява поръчката:">
	    	<h:inputText id="autoservice" value="#{aktualiziraneNaKlientskaPoru4ka.autoservice.name}" maxlength="100" 
	    		readonly="true"/>
	    	<h:message for="autoservice" />
	    </h:outputLabel> 
	    <br />
	    
	    <h:outputLabel value="Служител създал поръчката:">
	    	<h:inputText id="empname" value="#{aktualiziraneNaKlientskaPoru4ka.employee.name}" maxlength="50" 
	    		readonly="true"/>
	    	<h:message for="empname" />
	    	<h:inputText id="empfamily" value="#{aktualiziraneNaKlientskaPoru4ka.employee.family}" maxlength="50" 
	    		readonly="true"/>
	    	<h:message for="empfamily" />
	    </h:outputLabel> 
	    <br />
	  
		 <h:outputLabel value="Дата:">
	    	<h:inputText id="date" value="#{aktualiziraneNaKlientskaPoru4ka.date}" 
	    		readonly="true">
	    	<f:convertDateTime pattern="dd.MM.yyyy" />
	    	</h:inputText>>
	    </h:outputLabel> 
	    <br />
		
		<h:outputLabel value="Автомобилът е приет за ремонт*">
	   		<h:selectBooleanCheckbox value="#{aktualiziraneNaKlientskaPoru4ka.inAutoservice}" 
	   			disabled="#{!aktualiziraneNaKlientskaPoru4ka.rowSelected or !aktualiziraneNaKlientskaPoru4ka.changingAllowed}" />
	    </h:outputLabel>
	    <br />
	    
	    <h:outputLabel value="Услуги, които ще бъдат извършени:">
	    	<h:commandButton value="Избери" action="#{aktualiziraneNaKlientskaPoru4ka.chooseUsluga()}" 
				disabled="#{!aktualiziraneNaKlientskaPoru4ka.rowSelected or !aktualiziraneNaKlientskaPoru4ka.changingAllowed}"/> 
	    </h:outputLabel>
	    <br />
	    <!-- TODO: може ли да се сложи scroll bar по Y с определен брой редове --> 
		<div style="overflow-x: auto;"> <!-- scroll bar -->
		<h:dataTable
			value="#{aktualiziraneNaKlientskaPoru4ka.spisukUslugi}"
			var="curr"
			rowClasses="notSelectedRow">
				
			<h:column>
				<f:facet name="header">Наименование на услугата</f:facet>
				#{curr.clService.service.description}
			</h:column>
			
			<h:column>
				<f:facet name="header">Време за извършване (часа)</f:facet>
				#{curr.serviceDuration}
			</h:column>
			
			<h:column>
				<f:facet name="header">Цена на час</f:facet>
				#{curr.clService.priceHour}
			</h:column>
			
			<h:column>
				<f:facet name="header">Общо</f:facet>
				#{curr.fullPrice}
			</h:column>

			<h:column>
				<f:facet name="header">Кой заплаща услугата</f:facet>
				#{aktualiziraneNaKlientskaPoru4ka.getWhoWillPay(curr.clService.whoPays) }
			</h:column>
			
			
			<h:column>
				<f:facet name="header">Кой е извършил услугата</f:facet>
				#{curr.getEmployeeNames() }
			</h:column>
			
			
			<h:column>
				<f:facet name="header">Извършена услуга</f:facet>
				<h:commandLink action="#{aktualiziraneNaKlientskaPoru4ka.setEmployeeToService(curr)}" value="Извършена" />
			</h:column> 
			
			<h:column>
				<f:facet name="header">Премахни</f:facet>
				<h:commandLink action="#{aktualiziraneNaKlientskaPoru4ka.deleteUsluga(curr)}" value="Премахни" />
			</h:column> 
		</h:dataTable>
		</div>
		<br />
		
		
		<h:outputLabel value="Резервни части, които трябва ще бъдат вложени:">
	    	<h:commandButton  value="Избери" action="#{aktualiziraneNaKlientskaPoru4ka.chooseSparePart()}"
				disabled="#{!aktualiziraneNaKlientskaPoru4ka.rowSelected or !aktualiziraneNaKlientskaPoru4ka.changingAllowed}"/>
	    </h:outputLabel>
	    <br /> 
	    <!-- TODO: може ли да се сложи scroll bar по Y с определен брой редове 
	    Оцветяване на ред с липсващи резервни части-->
		<div style="overflow-x: auto;"> <!-- scroll bar -->
		<h:dataTable
			value="#{aktualiziraneNaKlientskaPoru4ka.spisukRezervni4asti}"
			var="curr"
			rowClasses="notSelectedRow">
				
			<h:column>
				<f:facet name="header">Група на резервната част</f:facet>
				#{curr.clPart.sparePart.sparePartGroup.description}
			</h:column>
				
			<h:column>
				<f:facet name="header">Име на резервната част</f:facet>
				#{curr.clPart.sparePart.name}
			</h:column>
				
			<h:column>
				<f:facet name="header">Нужно количество</f:facet>
				<h:outputText value="#{curr.clPart.quantity}" rendered="#{!curr.editing}" />
				<h:inputText value="#{curr.clPart.quantity}" rendered="#{curr.editing}" >
				<f:validateDoubleRange minimum="0.001" />
				</h:inputText>
			</h:column>
			
			<h:column>
				<f:facet name="header">Налично количество</f:facet>
				#{curr.quantityAvailable}
			</h:column>
			
			<h:column>
				<f:facet name="header">Резервирано количество</f:facet>
				#{curr.quantityReserved}
			</h:column>
			
			<h:column>
				<f:facet name="header">Вложено количество</f:facet>
				<h:outputText value="#{curr.quantityUsed}" rendered="#{!curr.editing}" />
				<h:inputText value="#{curr.quantityUsed}" rendered="#{curr.editing}" >
				<f:validateDoubleRange minimum="0.001" />
				</h:inputText>
			</h:column>
		
			<h:column>
				<f:facet name="header">Мерна единица</f:facet>
				#{curr.clPart.sparePart.measuringUnit}
			</h:column>
			
			<h:column>
				<f:facet name="header">Единична цена</f:facet>
				#{curr.clPart.priceUnit}
			</h:column>
			
			<h:column>
				<f:facet name="header">Общо</f:facet>
				#{curr.fullPrice}
			</h:column>

			<h:column>
				<f:facet name="header">Кой заплаща услугата</f:facet>
				#{aktualiziraneNaKlientskaPoru4ka.getWhoWillPay(curr.clPart.whoPays)}
			</h:column>
			
			<h:column>
				<f:facet name="header">Промени</f:facet>
				<h:commandLink action="#{aktualiziraneNaKlientskaPoru4ka.toggleEditSparePartForClientOrder(curr)}" value="Промени" />
			</h:column>
			
			<h:column>
				<f:facet name="header">Премахни</f:facet>
				<h:commandLink action="#{aktualiziraneNaKlientskaPoru4ka.deleteSparePart(curr)}" value="Премахни" />
			</h:column>
		
			</h:dataTable>
		</div>
		<br />
		
		<h:outputText value="Обща цена на поръчката: #{aktualiziraneNaKlientskaPoru4ka.clientOrderPrice}" />
		<br />

	    <h:outputLabel value="Номер на платежно нареждане">
	    	<h:inputText id="paynum" value="#{aktualiziraneNaKlientskaPoru4ka.paymentNumber}" maxlength="30" 
	    		readonly="#{!aktualiziraneNaKlientskaPoru4ka.rowSelected}"/>
	    	<h:message for="paynum" />
	    </h:outputLabel> 
	    <br />
	    
	     <h:outputLabel value="Статус на поръчката">
	    	<h:selectOneMenu value="#{aktualiziraneNaKlientskaPoru4ka.status}" 
	    	disabled="#{!aktualiziraneNaKlientskaPoru4ka.rowSelected || aktualiziraneNaKlientskaPoru4ka.isPaied()}">
				<f:selectItems value="#{aktualiziraneNaKlientskaPoru4ka.orderStatus}" />
			</h:selectOneMenu>
	    </h:outputLabel>
	    <br />	
	    
			<h:commandButton value="Запази" action="#{aktualiziraneNaKlientskaPoru4ka.saveOrder()}"
				disabled="#{!aktualiziraneNaKlientskaPoru4ka.rowSelected or !aktualiziraneNaKlientskaPoru4ka.changingAllowed}"/>
				
			<h:commandButton action="#{aktualiziraneNaKlientskaPoru4ka.deselectRow()}" value="Отмени"
				disabled="#{!aktualiziraneNaKlientskaPoru4ka.rowSelected}"/>
					
			<h:commandButton action="#{aktualiziraneNaKlientskaPoru4ka.goToAdd()}" value="Добави"
				disabled="#{!aktualiziraneNaKlientskaPoru4ka.goToAddAllowed}" />
	    	<br />
	    
	    	<h:outputText value="#{aktualiziraneNaKlientskaPoru4ka.errorMessage}"/>
	    
		</h:form>
	</ui:define>
	
</ui:composition>
</html>